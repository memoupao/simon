var REGEXP_UNICODE=function(){var b=[" ","\u0120",-1,"!","\u0120",-1,"\u0120","\u0120",0,"\u0121","\u0120",-1,"\u0121","\u0120|\u0121",0,"\u0122","\u0120|\u0121",-1,"\u0120","[\u0120]",0,"\u0121","[\u0120]",-1,"\u0121","[\u0120\u0121]",0,"\u0122","[\u0120\u0121]",-1,"\u0121","[\u0120-\u0121]",0,"\u0122","[\u0120-\u0121]",-1];for(var a=0;a<b.length;a+=3){if(b[a].search(new RegExp(b[a+1]))!=b[a+2]){return false}}return true}();var XML_S="[ \t\r\n]+";var XML_EQ="("+XML_S+")?=("+XML_S+")?";var XML_CHAR_REF="&#[0-9]+;|&#x[0-9a-fA-F]+;";var XML10_VERSION_INFO=XML_S+"version"+XML_EQ+"(\"1\\.0\"|'1\\.0')";var XML10_BASE_CHAR=(REGEXP_UNICODE)?"\u0041-\u005a\u0061-\u007a\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u00ff\u0100-\u0131\u0134-\u013e\u0141-\u0148\u014a-\u017e\u0180-\u01c3\u01cd-\u01f0\u01f4-\u01f5\u01fa-\u0217\u0250-\u02a8\u02bb-\u02c1\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03ce\u03d0-\u03d6\u03da\u03dc\u03de\u03e0\u03e2-\u03f3\u0401-\u040c\u040e-\u044f\u0451-\u045c\u045e-\u0481\u0490-\u04c4\u04c7-\u04c8\u04cb-\u04cc\u04d0-\u04eb\u04ee-\u04f5\u04f8-\u04f9\u0531-\u0556\u0559\u0561-\u0586\u05d0-\u05ea\u05f0-\u05f2\u0621-\u063a\u0641-\u064a\u0671-\u06b7\u06ba-\u06be\u06c0-\u06ce\u06d0-\u06d3\u06d5\u06e5-\u06e6\u0905-\u0939\u093d\u0958-\u0961\u0985-\u098c\u098f-\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09dc-\u09dd\u09df-\u09e1\u09f0-\u09f1\u0a05-\u0a0a\u0a0f-\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32-\u0a33\u0a35-\u0a36\u0a38-\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8b\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2-\u0ab3\u0ab5-\u0ab9\u0abd\u0ae0\u0b05-\u0b0c\u0b0f-\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32-\u0b33\u0b36-\u0b39\u0b3d\u0b5c-\u0b5d\u0b5f-\u0b61\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99-\u0b9a\u0b9c\u0b9e-\u0b9f\u0ba3-\u0ba4\u0ba8-\u0baa\u0bae-\u0bb5\u0bb7-\u0bb9\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c60-\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cde\u0ce0-\u0ce1\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d28\u0d2a-\u0d39\u0d60-\u0d61\u0e01-\u0e2e\u0e30\u0e32-\u0e33\u0e40-\u0e45\u0e81-\u0e82\u0e84\u0e87-\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa-\u0eab\u0ead-\u0eae\u0eb0\u0eb2-\u0eb3\u0ebd\u0ec0-\u0ec4\u0f40-\u0f47\u0f49-\u0f69\u10a0-\u10c5\u10d0-\u10f6\u1100\u1102-\u1103\u1105-\u1107\u1109\u110b-\u110c\u110e-\u1112\u113c\u113e\u1140\u114c\u114e\u1150\u1154-\u1155\u1159\u115f-\u1161\u1163\u1165\u1167\u1169\u116d-\u116e\u1172-\u1173\u1175\u119e\u11a8\u11ab\u11ae-\u11af\u11b7-\u11b8\u11ba\u11bc-\u11c2\u11eb\u11f0\u11f9\u1e00-\u1e9b\u1ea0-\u1ef9\u1f00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2126\u212a-\u212b\u212e\u2180-\u2182\u3041-\u3094\u30a1-\u30fa\u3105-\u312c\uac00-\ud7a3":"A-Za-z";var XML10_IDEOGRAPHIC=(REGEXP_UNICODE)?"\u4e00-\u9fa5\u3007\u3021-\u3029":"";var XML10_COMBINING_CHAR=(REGEXP_UNICODE)?"\u0300-\u0345\u0360-\u0361\u0483-\u0486\u0591-\u05a1\u05a3-\u05b9\u05bb-\u05bd\u05bf\u05c1-\u05c2\u05c4\u064b-\u0652\u0670\u06d6-\u06dc\u06dd-\u06df\u06e0-\u06e4\u06e7-\u06e8\u06ea-\u06ed\u0901-\u0903\u093c\u093e-\u094c\u094d\u0951-\u0954\u0962-\u0963\u0981-\u0983\u09bc\u09be\u09bf\u09c0-\u09c4\u09c7-\u09c8\u09cb-\u09cd\u09d7\u09e2-\u09e3\u0a02\u0a3c\u0a3e\u0a3f\u0a40-\u0a42\u0a47-\u0a48\u0a4b-\u0a4d\u0a70-\u0a71\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0b01-\u0b03\u0b3c\u0b3e-\u0b43\u0b47-\u0b48\u0b4b-\u0b4d\u0b56-\u0b57\u0b82-\u0b83\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0c01-\u0c03\u0c3e-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55-\u0c56\u0c82-\u0c83\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5-\u0cd6\u0d02-\u0d03\u0d3e-\u0d43\u0d46-\u0d48\u0d4a-\u0d4d\u0d57\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb-\u0ebc\u0ec8-\u0ecd\u0f18-\u0f19\u0f35\u0f37\u0f39\u0f3e\u0f3f\u0f71-\u0f84\u0f86-\u0f8b\u0f90-\u0f95\u0f97\u0f99-\u0fad\u0fb1-\u0fb7\u0fb9\u20d0-\u20dc\u20e1\u302a-\u302f\u3099\u309a":"";var XML10_DIGIT=(REGEXP_UNICODE)?"\u0030-\u0039\u0660-\u0669\u06f0-\u06f9\u0966-\u096f\u09e6-\u09ef\u0a66-\u0a6f\u0ae6-\u0aef\u0b66-\u0b6f\u0be7-\u0bef\u0c66-\u0c6f\u0ce6-\u0cef\u0d66-\u0d6f\u0e50-\u0e59\u0ed0-\u0ed9\u0f20-\u0f29":"0-9";var XML10_EXTENDER=(REGEXP_UNICODE)?"\u00b7\u02d0\u02d1\u0387\u0640\u0e46\u0ec6\u3005\u3031-\u3035\u309d-\u309e\u30fc-\u30fe":"";var XML10_LETTER=XML10_BASE_CHAR+XML10_IDEOGRAPHIC;var XML10_NAME_CHAR=XML10_LETTER+XML10_DIGIT+"\\._:"+XML10_COMBINING_CHAR+XML10_EXTENDER+"-";var XML10_NAME="["+XML10_LETTER+"_:]["+XML10_NAME_CHAR+"]*";var XML10_ENTITY_REF="&"+XML10_NAME+";";var XML10_REFERENCE=XML10_ENTITY_REF+"|"+XML_CHAR_REF;var XML10_ATT_VALUE='"(([^<&"]|'+XML10_REFERENCE+")*)\"|'(([^<&']|"+XML10_REFERENCE+")*)'";var XML10_ATTRIBUTE="("+XML10_NAME+")"+XML_EQ+"("+XML10_ATT_VALUE+")";var XML11_VERSION_INFO=XML_S+"version"+XML_EQ+"(\"1\\.1\"|'1\\.1')";var XML11_NAME_START_CHAR=(REGEXP_UNICODE)?":A-Z_a-z\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c-\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd":":A-Z_a-z";var XML11_NAME_CHAR=XML11_NAME_START_CHAR+((REGEXP_UNICODE)?"\\.0-9\u00b7\u0300-\u036f\u203f-\u2040-":"\\.0-9-");var XML11_NAME="["+XML11_NAME_START_CHAR+"]["+XML11_NAME_CHAR+"]*";var XML11_ENTITY_REF="&"+XML11_NAME+";";var XML11_REFERENCE=XML11_ENTITY_REF+"|"+XML_CHAR_REF;var XML11_ATT_VALUE='"(([^<&"]|'+XML11_REFERENCE+")*)\"|'(([^<&']|"+XML11_REFERENCE+")*)'";var XML11_ATTRIBUTE="("+XML11_NAME+")"+XML_EQ+"("+XML11_ATT_VALUE+")";var XML_NC_NAME_CHAR=XML10_LETTER+XML10_DIGIT+"\\._"+XML10_COMBINING_CHAR+XML10_EXTENDER+"-";var XML_NC_NAME="["+XML10_LETTER+"_]["+XML_NC_NAME_CHAR+"]*";var DOM_ELEMENT_NODE=1;var DOM_ATTRIBUTE_NODE=2;var DOM_TEXT_NODE=3;var DOM_CDATA_SECTION_NODE=4;var DOM_ENTITY_REFERENCE_NODE=5;var DOM_ENTITY_NODE=6;var DOM_PROCESSING_INSTRUCTION_NODE=7;var DOM_COMMENT_NODE=8;var DOM_DOCUMENT_NODE=9;var DOM_DOCUMENT_TYPE_NODE=10;var DOM_DOCUMENT_FRAGMENT_NODE=11;var DOM_NOTATION_NODE=12;function xpathLog(a){}function xsltLog(a){}function xsltLogXml(a){}function assert(a){if(!a){throw"Assertion failed"}}function stringSplit(e,g){var d=e.indexOf(g);if(d==-1){return[e]}var f=[];f.push(e.substr(0,d));while(d!=-1){var b=e.indexOf(g,d+1);if(b!=-1){f.push(e.substr(d+1,b-d-1))}else{f.push(e.substr(d+1))}d=b}return f}function mapExec(c,b){for(var a=0;a<c.length;++a){b.call(this,c[a],a)}}function mapExpr(d,c){var a=[];for(var b=0;b<d.length;++b){a.push(c(d[b]))}return a}function reverseInplace(d){for(var a=0;a<d.length/2;++a){var c=d[a];var b=d.length-a-1;d[a]=d[b];d[b]=c}}function removeFromArray(e,c,d){var a=0;for(var b=0;b<e.length;++b){if(e[b]===c||(d&&e[b]==c)){e.splice(b--,1);a++}}return a}function copyArray(c,b){for(var a=0;a<b.length;++a){c.push(b[a])}}function xmlValue(c){if(!c){return""}var a="";if(c.nodeType==DOM_TEXT_NODE||c.nodeType==DOM_CDATA_SECTION_NODE||c.nodeType==DOM_ATTRIBUTE_NODE){a+=c.nodeValue}else{if(c.nodeType==DOM_ELEMENT_NODE||c.nodeType==DOM_DOCUMENT_NODE||c.nodeType==DOM_DOCUMENT_FRAGMENT_NODE){for(var b=0;b<c.childNodes.length;++b){a+=arguments.callee(c.childNodes[b])}}}return a}function xpathParse(n){xpathLog("parse "+n);xpathParseInit();var a=xpathCacheLookup(n);if(a){xpathLog(" ... cached");return a}if(n.match(/^(\$|@)?\w+$/i)){var j=makeSimpleExpr(n);xpathParseCache[n]=j;xpathLog(" ... simple");return j}if(n.match(/^\w+(\/\w+)*$/i)){var j=makeSimpleExpr2(n);xpathParseCache[n]=j;xpathLog(" ... simple 2");return j}var k=n;var m=[];var b=null;var g=null;var c=false;var h=0;var f=0;var p=0;while(!c){h++;n=n.replace(/^\s*/,"");g=b;b=null;var l=null;var e="";for(var d=0;d<xpathTokenRules.length;++d){var o=xpathTokenRules[d].re.exec(n);f++;if(o&&o.length>0&&o[0].length>e.length){l=xpathTokenRules[d];e=o[0];break}}if(l&&(l==TOK_DIV||l==TOK_MOD||l==TOK_AND||l==TOK_OR)&&(!g||g.tag==TOK_AT||g.tag==TOK_DSLASH||g.tag==TOK_SLASH||g.tag==TOK_AXIS||g.tag==TOK_DOLLAR)){l=TOK_QNAME}if(l){n=n.substr(e.length);xpathLog("token: "+e+" -- "+l.label);b={tag:l,match:e,prec:l.prec?l.prec:0,expr:makeTokenExpr(e)}}else{xpathLog("DONE");c=true}while(xpathReduce(m,b)){p++;xpathLog("stack: "+stackToString(m))}}xpathLog("stack: "+stackToString(m));if(m.length!=1){throw"XPath parse error "+k+":\n"+stackToString(m)}var o=m[0].expr;xpathParseCache[k]=o;xpathLog("XPath parse: "+h+" / "+f+" / "+p);return o}var xpathParseCache={};function xpathCacheLookup(a){return xpathParseCache[a]}function xpathReduce(h,a){var e=null;if(h.length>0){var f=h[h.length-1];var j=xpathRules[f.tag.key];if(j){for(var b=0;b<j.length;++b){var g=j[b];var c=xpathMatchStack(h,g[1]);if(c.length){e={tag:g[0],rule:g,match:c};e.prec=xpathGrammarPrecedence(e);break}}}}var d;if(e&&(!a||e.prec>a.prec||(a.tag.left&&e.prec>=a.prec))){for(var b=0;b<e.match.matchlength;++b){h.pop()}xpathLog("reduce "+e.tag.label+" "+e.prec+" ahead "+(a?a.tag.label+" "+a.prec+(a.tag.left?" left":""):" none "));var k=mapExpr(e.match,function(i){return i.expr});e.expr=e.rule[3].apply(null,k);h.push(e);d=true}else{if(a){xpathLog("shift "+a.tag.label+" "+a.prec+(a.tag.left?" left":"")+" over "+(e?e.tag.label+" "+e.prec:" none"));h.push(a)}d=false}return d}function xpathMatchStack(h,g){var d=h.length;var f=g.length;var b,i;var e=[];e.matchlength=0;var c=0;for(b=f-1,i=d-1;b>=0&&i>=0;--b,i-=c){c=0;var a=[];if(g[b]==Q_MM){b-=1;e.push(a);while(i-c>=0&&h[i-c].tag==g[b]){a.push(h[i-c]);c+=1;e.matchlength+=1}}else{if(g[b]==Q_01){b-=1;e.push(a);while(i-c>=0&&c<2&&h[i-c].tag==g[b]){a.push(h[i-c]);c+=1;e.matchlength+=1}}else{if(g[b]==Q_1M){b-=1;e.push(a);if(h[i].tag==g[b]){while(i-c>=0&&h[i-c].tag==g[b]){a.push(h[i-c]);c+=1;e.matchlength+=1}}else{return[]}}else{if(h[i].tag==g[b]){e.push(h[i]);c+=1;e.matchlength+=1}else{return[]}}}}reverseInplace(a);a.expr=mapExpr(a,function(j){return j.expr})}reverseInplace(e);if(b==-1){return e}else{return[]}}function xpathTokenPrecedence(a){return a.prec||2}function xpathGrammarPrecedence(e){var b=0;if(e.rule){if(e.rule.length>=3&&e.rule[2]>=0){b=e.rule[2]}else{for(var c=0;c<e.rule[1].length;++c){var d=xpathTokenPrecedence(e.rule[1][c]);b=Math.max(b,d)}}}else{if(e.tag){b=xpathTokenPrecedence(e.tag)}else{if(e.length){for(var a=0;a<e.length;++a){var d=xpathGrammarPrecedence(e[a]);b=Math.max(b,d)}}}}return b}function stackToString(a){var b="";for(var c=0;c<a.length;++c){if(b){b+="\n"}b+=a[c].tag.label}return b}function ExprContext(c,a,d,b){this.node=c;this.position=a||0;this.nodelist=d||[c];this.variables={};this.parent=b||null;if(b){this.root=b.root}else{if(this.node.nodeType==DOM_DOCUMENT_NODE){this.root=c}else{this.root=c.ownerDocument}}}ExprContext.prototype.clone=function(c,a,b){return new ExprContext(c||this.node,typeof a!="undefined"?a:this.position,b||this.nodelist,this)};ExprContext.prototype.setVariable=function(a,b){this.variables[a]=b};ExprContext.prototype.getVariable=function(a){if(typeof this.variables[a]!="undefined"){return this.variables[a]}else{if(this.parent){return this.parent.getVariable(a)}else{return null}}};ExprContext.prototype.setNode=function(a){this.node=this.nodelist[a];this.position=a};ExprContext.prototype.contextSize=function(){return this.nodelist.length};function StringValue(a){this.value=a;this.type="string"}StringValue.prototype.stringValue=function(){return this.value};StringValue.prototype.booleanValue=function(){return this.value.length>0};StringValue.prototype.numberValue=function(){return this.value-0};StringValue.prototype.nodeSetValue=function(){throw this};function BooleanValue(a){this.value=a;this.type="boolean"}BooleanValue.prototype.stringValue=function(){return""+this.value};BooleanValue.prototype.booleanValue=function(){return this.value};BooleanValue.prototype.numberValue=function(){return this.value?1:0};BooleanValue.prototype.nodeSetValue=function(){throw this};function NumberValue(a){this.value=a;this.type="number"}NumberValue.prototype.stringValue=function(){return""+this.value};NumberValue.prototype.booleanValue=function(){return !!this.value};NumberValue.prototype.numberValue=function(){return this.value-0};NumberValue.prototype.nodeSetValue=function(){throw this};function NodeSetValue(a){this.value=a;this.type="node-set"}NodeSetValue.prototype.stringValue=function(){if(this.value.length==0){return""}else{return xmlValue(this.value[0])}};NodeSetValue.prototype.booleanValue=function(){return this.value.length>0};NodeSetValue.prototype.numberValue=function(){return this.stringValue()-0};NodeSetValue.prototype.nodeSetValue=function(){return this.value};function TokenExpr(a){this.value=a}TokenExpr.prototype.evaluate=function(){return new StringValue(this.value)};function LocationExpr(){this.absolute=false;this.steps=[]}LocationExpr.prototype.appendStep=function(a){this.steps.push(a)};LocationExpr.prototype.prependStep=function(c){var a=this.steps;this.steps=[c];for(var b=0;b<a.length;++b){this.steps.push(a[b])}};LocationExpr.prototype.evaluate=function(a){var c;if(this.absolute){c=a.root}else{c=a.node}var b=[];xPathStep(b,this.steps,0,c,a);return new NodeSetValue(b)};function xPathStep(a,e,b,f,h){var j=e[b];var d=h.clone(f);var g=j.evaluate(d).nodeSetValue();for(var c=0;c<g.length;++c){if(b==e.length-1){a.push(g[c])}else{xPathStep(a,e,b+1,g[c],h)}}}function StepExpr(b,c,a){this.axis=b;this.nodetest=c;this.predicate=a||[]}StepExpr.prototype.appendPredicate=function(a){this.predicate.push(a)};StepExpr.prototype.evaluate=function(a){var c=a.node;var f=[];if(this.axis==xpathAxis.ANCESTOR_OR_SELF){f.push(c);for(var h=c.parentNode;h;h=h.parentNode){f.push(h)}}else{if(this.axis==xpathAxis.ANCESTOR){for(var h=c.parentNode;h;h=h.parentNode){f.push(h)}}else{if(this.axis==xpathAxis.ATTRIBUTE){copyArray(f,c.attributes)}else{if(this.axis==xpathAxis.CHILD){copyArray(f,c.childNodes)}else{if(this.axis==xpathAxis.DESCENDANT_OR_SELF){f.push(c);xpathCollectDescendants(f,c)}else{if(this.axis==xpathAxis.DESCENDANT){xpathCollectDescendants(f,c)}else{if(this.axis==xpathAxis.FOLLOWING){for(var h=c;h;h=h.parentNode){for(var g=h.nextSibling;g;g=g.nextSibling){f.push(g);xpathCollectDescendants(f,g)}}}else{if(this.axis==xpathAxis.FOLLOWING_SIBLING){for(var h=c.nextSibling;h;h=h.nextSibling){f.push(h)}}else{if(this.axis==xpathAxis.NAMESPACE){alert("not implemented: axis namespace")}else{if(this.axis==xpathAxis.PARENT){if(c.parentNode){f.push(c.parentNode)}}else{if(this.axis==xpathAxis.PRECEDING){for(var h=c;h;h=h.parentNode){for(var g=h.previousSibling;g;g=g.previousSibling){f.push(g);xpathCollectDescendantsReverse(f,g)}}}else{if(this.axis==xpathAxis.PRECEDING_SIBLING){for(var h=c.previousSibling;h;h=h.previousSibling){f.push(h)}}else{if(this.axis==xpathAxis.SELF){f.push(c)}else{throw"ERROR -- NO SUCH AXIS: "+this.axis}}}}}}}}}}}}}var b=f;f=[];for(var d=0;d<b.length;++d){var h=b[d];if(this.nodetest.evaluate(a.clone(h,d,b)).booleanValue()){f.push(h)}}for(var d=0;d<this.predicate.length;++d){var b=f;f=[];for(var e=0;e<b.length;++e){var h=b[e];if(this.predicate[d].evaluate(a.clone(h,e,b)).booleanValue()){f.push(h)}}}return new NodeSetValue(f)};function NodeTestAny(){this.value=new BooleanValue(true)}NodeTestAny.prototype.evaluate=function(a){return this.value};function NodeTestElementOrAttribute(){}NodeTestElementOrAttribute.prototype.evaluate=function(a){return new BooleanValue(a.node.nodeType==DOM_ELEMENT_NODE||a.node.nodeType==DOM_ATTRIBUTE_NODE)};function NodeTestText(){}NodeTestText.prototype.evaluate=function(a){return new BooleanValue(a.node.nodeType==DOM_TEXT_NODE)};function NodeTestComment(){}NodeTestComment.prototype.evaluate=function(a){return new BooleanValue(a.node.nodeType==DOM_COMMENT_NODE)};function NodeTestPI(a){this.target=a}NodeTestPI.prototype.evaluate=function(a){return new BooleanValue(a.node.nodeType==DOM_PROCESSING_INSTRUCTION_NODE&&(!this.target||a.node.nodeName==this.target))};function NodeTestNC(a){this.regex=new RegExp("^"+a+":");this.nsprefix=a}NodeTestNC.prototype.evaluate=function(a){var b=a.node;return new BooleanValue(this.regex.match(b.nodeName))};function NodeTestName(a){this.name=a}NodeTestName.prototype.evaluate=function(a){var b=a.node;return new BooleanValue(b.nodeName==this.name)};function PredicateExpr(a){this.expr=a}PredicateExpr.prototype.evaluate=function(a){var b=this.expr.evaluate(a);if(b.type=="number"){return new BooleanValue(a.position==b.numberValue()-1)}else{return new BooleanValue(b.booleanValue())}};function FunctionCallExpr(a){this.name=a;this.args=[]}FunctionCallExpr.prototype.appendArg=function(a){this.args.push(a)};FunctionCallExpr.prototype.evaluate=function(a){var b=""+this.name.value;var c=this.xpathfunctions[b];if(c){return c.call(this,a)}else{xpathLog("XPath NO SUCH FUNCTION "+b);return new BooleanValue(false)}};FunctionCallExpr.prototype.xpathfunctions={last:function(a){assert(this.args.length==0);return new NumberValue(a.contextSize())},position:function(a){assert(this.args.length==0);return new NumberValue(a.position+1)},count:function(a){assert(this.args.length==1);var b=this.args[0].evaluate(a);return new NumberValue(b.nodeSetValue().length)},id:function(m){assert(this.args.length==1);var g=this.args[0].evaluate(m);var h=[];var a;if(g.type=="node-set"){a=[];var b=g.nodeSetValue();for(var f=0;f<b.length;++f){var k=xmlValue(b[f]).split(/\s+/);for(var l=0;l<k.length;++l){a.push(k[l])}}}else{a=g.stringValue().split(/\s+/)}var j=m.node.ownerDocument;for(var f=0;f<a.length;++f){var c=j.getElementById(a[f]);if(c){h.push(c)}}return new NodeSetValue(h)},"local-name":function(a){alert("not implmented yet: XPath function local-name()")},"namespace-uri":function(a){alert("not implmented yet: XPath function namespace-uri()")},name:function(a){assert(this.args.length==1||this.args.length==0);var b;if(this.args.length==0){b=[a.node]}else{b=this.args[0].evaluate(a).nodeSetValue()}if(b.length==0){return new StringValue("")}else{return new StringValue(b[0].nodeName)}},string:function(a){assert(this.args.length==1||this.args.length==0);if(this.args.length==0){return new StringValue(new NodeSetValue([a.node]).stringValue())}else{return new StringValue(this.args[0].evaluate(a).stringValue())}},concat:function(a){var b="";for(var c=0;c<this.args.length;++c){b+=this.args[c].evaluate(a).stringValue()}return new StringValue(b)},"starts-with":function(a){assert(this.args.length==2);var c=this.args[0].evaluate(a).stringValue();var b=this.args[1].evaluate(a).stringValue();return new BooleanValue(c.indexOf(b)==0)},contains:function(a){assert(this.args.length==2);var c=this.args[0].evaluate(a).stringValue();var b=this.args[1].evaluate(a).stringValue();return new BooleanValue(c.indexOf(b)!=-1)},"substring-before":function(a){assert(this.args.length==2);var e=this.args[0].evaluate(a).stringValue();var d=this.args[1].evaluate(a).stringValue();var c=e.indexOf(d);var b;if(c==-1){b=""}else{b=e.substr(0,c)}return new StringValue(b)},"substring-after":function(a){assert(this.args.length==2);var e=this.args[0].evaluate(a).stringValue();var d=this.args[1].evaluate(a).stringValue();var c=e.indexOf(d);var b;if(c==-1){b=""}else{b=e.substr(c+d.length)}return new StringValue(b)},substring:function(a){assert(this.args.length==2||this.args.length==3);var f=this.args[0].evaluate(a).stringValue();var d=this.args[1].evaluate(a).numberValue();var c;if(this.args.length==2){var g=Math.max(0,Math.round(d)-1);c=f.substr(g)}else{var b=this.args[2].evaluate(a).numberValue();var h=Math.round(d)-1;var g=Math.max(0,h);var e=Math.round(b)-Math.max(0,-h);c=f.substr(g,e)}return new StringValue(c)},"string-length":function(a){var b;if(this.args.length>0){b=this.args[0].evaluate(a).stringValue()}else{b=new NodeSetValue([a.node]).stringValue()}return new NumberValue(b.length)},"normalize-space":function(a){var b;if(this.args.length>0){b=this.args[0].evaluate(a).stringValue()}else{b=new NodeSetValue([a.node]).stringValue()}b=b.replace(/^\s*/,"").replace(/\s*$/,"").replace(/\s+/g," ");return new StringValue(b)},translate:function(a){assert(this.args.length==3);var e=this.args[0].evaluate(a).stringValue();var d=this.args[1].evaluate(a).stringValue();var b=this.args[2].evaluate(a).stringValue();for(var c=0;c<d.length;++c){e=e.replace(new RegExp(d.charAt(c),"g"),b.charAt(c))}return new StringValue(e)},"boolean":function(a){assert(this.args.length==1);return new BooleanValue(this.args[0].evaluate(a).booleanValue())},not:function(a){assert(this.args.length==1);var b=!this.args[0].evaluate(a).booleanValue();return new BooleanValue(b)},"true":function(a){assert(this.args.length==0);return new BooleanValue(true)},"false":function(a){assert(this.args.length==0);return new BooleanValue(false)},lang:function(a){assert(this.args.length==1);var c=this.args[0].evaluate(a).stringValue();var e;var d=a.node;while(d&&d!=d.parentNode){e=d.getAttribute("xml:lang");if(e){break}d=d.parentNode}if(!e){return new BooleanValue(false)}else{var b=new RegExp("^"+c+"$","i");return new BooleanValue(e.match(b)||e.replace(/_.*$/,"").match(b))}},number:function(a){assert(this.args.length==1||this.args.length==0);if(this.args.length==1){return new NumberValue(this.args[0].evaluate(a).numberValue())}else{return new NumberValue(new NodeSetValue([a.node]).numberValue())}},sum:function(a){assert(this.args.length==1);var d=this.args[0].evaluate(a).nodeSetValue();var c=0;for(var b=0;b<d.length;++b){c+=xmlValue(d[b])-0}return new NumberValue(c)},floor:function(a){assert(this.args.length==1);var b=this.args[0].evaluate(a).numberValue();return new NumberValue(Math.floor(b))},ceiling:function(a){assert(this.args.length==1);var b=this.args[0].evaluate(a).numberValue();return new NumberValue(Math.ceil(b))},round:function(a){assert(this.args.length==1);var b=this.args[0].evaluate(a).numberValue();return new NumberValue(Math.round(b))},"ext-join":function(a){assert(this.args.length==2);var b=this.args[0].evaluate(a).nodeSetValue();var e=this.args[1].evaluate(a).stringValue();var c="";for(var d=0;d<b.length;++d){if(c){c+=e}c+=xmlValue(b[d])}return new StringValue(c)},"ext-if":function(a){assert(this.args.length==3);if(this.args[0].evaluate(a).booleanValue()){return this.args[1].evaluate(a)}else{return this.args[2].evaluate(a)}},"ext-cardinal":function(a){assert(this.args.length>=1);var e=this.args[0].evaluate(a).numberValue();var b=[];for(var d=0;d<e;++d){b.push(a.node)}return new NodeSetValue(b)}};function UnionExpr(b,a){this.expr1=b;this.expr2=a}UnionExpr.prototype.evaluate=function(c){var b=this.expr1.evaluate(c).nodeSetValue();var a=this.expr2.evaluate(c).nodeSetValue();var f=b.length;for(var d=0;d<a.length;++d){var h=a[d];var g=false;for(var e=0;e<f;++e){if(b[e]==h){g=true;e=f}}if(!g){b.push(h)}}return new NodeSetValue(b)};function PathExpr(b,a){this.filter=b;this.rel=a}PathExpr.prototype.evaluate=function(b){var d=this.filter.evaluate(b).nodeSetValue();var a=[];for(var e=0;e<d.length;++e){var c=this.rel.evaluate(b.clone(d[e],e,d)).nodeSetValue();for(var f=0;f<c.length;++f){a.push(c[f])}}return new NodeSetValue(a)};function FilterExpr(b,a){this.expr=b;this.predicate=a}FilterExpr.prototype.evaluate=function(a){var c=this.expr.evaluate(a).nodeSetValue();for(var e=0;e<this.predicate.length;++e){var b=c;c=[];for(var d=0;d<b.length;++d){var f=b[d];if(this.predicate[e].evaluate(a.clone(f,d,b)).booleanValue()){c.push(f)}}}return new NodeSetValue(c)};function UnaryMinusExpr(a){this.expr=a}UnaryMinusExpr.prototype.evaluate=function(a){return new NumberValue(-this.expr.evaluate(a).numberValue())};function BinaryExpr(b,c,a){this.expr1=b;this.expr2=a;this.op=c}BinaryExpr.prototype.evaluate=function(a){var b;switch(this.op.value){case"or":b=new BooleanValue(this.expr1.evaluate(a).booleanValue()||this.expr2.evaluate(a).booleanValue());break;case"and":b=new BooleanValue(this.expr1.evaluate(a).booleanValue()&&this.expr2.evaluate(a).booleanValue());break;case"+":b=new NumberValue(this.expr1.evaluate(a).numberValue()+this.expr2.evaluate(a).numberValue());break;case"-":b=new NumberValue(this.expr1.evaluate(a).numberValue()-this.expr2.evaluate(a).numberValue());break;case"*":b=new NumberValue(this.expr1.evaluate(a).numberValue()*this.expr2.evaluate(a).numberValue());break;case"mod":b=new NumberValue(this.expr1.evaluate(a).numberValue()%this.expr2.evaluate(a).numberValue());break;case"div":b=new NumberValue(this.expr1.evaluate(a).numberValue()/this.expr2.evaluate(a).numberValue());break;case"=":b=this.compare(a,function(d,c){return d==c});break;case"!=":b=this.compare(a,function(d,c){return d!=c});break;case"<":b=this.compare(a,function(d,c){return d<c});break;case"<=":b=this.compare(a,function(d,c){return d<=c});break;case">":b=this.compare(a,function(d,c){return d>c});break;case">=":b=this.compare(a,function(d,c){return d>=c});break;default:alert("BinaryExpr.evaluate: "+this.op.value)}return b};BinaryExpr.prototype.compare=function(m,h){var k=this.expr1.evaluate(m);var j=this.expr2.evaluate(m);var g;if(k.type=="node-set"&&j.type=="node-set"){var f=k.nodeSetValue();var e=j.nodeSetValue();g=false;for(var c=0;c<f.length;++c){for(var b=0;b<e.length;++b){if(h(xmlValue(f[c]),xmlValue(e[b]))){g=true;b=e.length;c=f.length}}}}else{if(k.type=="node-set"||j.type=="node-set"){if(k.type=="number"){var o=k.numberValue();var a=j.nodeSetValue();g=false;for(var d=0;d<a.length;++d){var l=xmlValue(a[d])-0;if(h(o,l)){g=true;break}}}else{if(j.type=="number"){var a=k.nodeSetValue();var o=j.numberValue();g=false;for(var d=0;d<a.length;++d){var l=xmlValue(a[d])-0;if(h(l,o)){g=true;break}}}else{if(k.type=="string"){var o=k.stringValue();var a=j.nodeSetValue();g=false;for(var d=0;d<a.length;++d){var l=xmlValue(a[d]);if(h(o,l)){g=true;break}}}else{if(j.type=="string"){var a=k.nodeSetValue();var o=j.stringValue();g=false;for(var d=0;d<a.length;++d){var l=xmlValue(a[d]);if(h(l,o)){g=true;break}}}else{g=h(k.booleanValue(),j.booleanValue())}}}}}else{if(k.type=="boolean"||j.type=="boolean"){g=h(k.booleanValue(),j.booleanValue())}else{if(k.type=="number"||j.type=="number"){g=h(k.numberValue(),j.numberValue())}else{g=h(k.stringValue(),j.stringValue())}}}}return new BooleanValue(g)};function LiteralExpr(a){this.value=a}LiteralExpr.prototype.evaluate=function(a){return new StringValue(this.value)};function NumberExpr(a){this.value=a}NumberExpr.prototype.evaluate=function(a){return new NumberValue(this.value)};function VariableExpr(a){this.name=a}VariableExpr.prototype.evaluate=function(a){return a.getVariable(this.name)};function makeTokenExpr(a){return new TokenExpr(a)}function passExpr(a){return a}function makeLocationExpr1(b,a){a.absolute=true;return a}function makeLocationExpr2(b,a){a.absolute=true;a.prependStep(makeAbbrevStep(b.value));return a}function makeLocationExpr3(b){var a=new LocationExpr();a.appendStep(makeAbbrevStep("."));a.absolute=true;return a}function makeLocationExpr4(b){var a=new LocationExpr();a.absolute=true;a.appendStep(makeAbbrevStep(b.value));return a}function makeLocationExpr5(b){var a=new LocationExpr();a.appendStep(b);return a}function makeLocationExpr6(a,b,c){a.appendStep(c);return a}function makeLocationExpr7(a,b,c){a.appendStep(makeAbbrevStep(b.value));return a}function makeStepExpr1(a){return makeAbbrevStep(a.value)}function makeStepExpr2(a){return makeAbbrevStep(a.value)}function makeStepExpr3(a,b,c){return new StepExpr(a.value,c)}function makeStepExpr4(a,b){return new StepExpr("attribute",b)}function makeStepExpr5(a){return new StepExpr("child",a)}function makeStepExpr6(b,a){b.appendPredicate(a);return b}function makeAbbrevStep(a){switch(a){case"//":return new StepExpr("descendant-or-self",new NodeTestAny);case".":return new StepExpr("self",new NodeTestAny);case"..":return new StepExpr("parent",new NodeTestAny)}}function makeNodeTestExpr1(a){return new NodeTestElementOrAttribute}function makeNodeTestExpr2(a,b,c){return new NodeTestNC(a.value)}function makeNodeTestExpr3(a){return new NodeTestName(a.value)}function makeNodeTestExpr4(c,a){var b=c.value.replace(/\s*\($/,"");switch(b){case"node":return new NodeTestAny;case"text":return new NodeTestText;case"comment":return new NodeTestComment;case"processing-instruction":return new NodeTestPI("")}}function makeNodeTestExpr5(d,c,a){var b=d.replace(/\s*\($/,"");if(b!="processing-instruction"){throw b}return new NodeTestPI(c.value)}function makePredicateExpr(c,b,a){return new PredicateExpr(b)}function makePrimaryExpr(c,b,a){return b}function makeFunctionCallExpr1(b,c,a){return new FunctionCallExpr(b)}function makeFunctionCallExpr2(e,g,d,c,a){var b=new FunctionCallExpr(e);b.appendArg(d);for(var f=0;f<c.length;++f){b.appendArg(c[f])}return b}function makeArgumentExpr(a,b){return b}function makeUnionExpr(c,a,b){return new UnionExpr(c,b)}function makePathExpr1(c,b,a){return new PathExpr(c,a)}function makePathExpr2(c,b,a){a.prependStep(makeAbbrevStep(b.value));return new PathExpr(c,a)}function makeFilterExpr(b,a){if(a.length>0){return new FilterExpr(b,a)}else{return b}}function makeUnaryMinusExpr(a,b){return new UnaryMinusExpr(b)}function makeBinaryExpr(b,c,a){return new BinaryExpr(b,c,a)}function makeLiteralExpr(a){var b=a.value.substring(1,a.value.length-1);return new LiteralExpr(b)}function makeNumberExpr(a){return new NumberExpr(a.value)}function makeVariableReference(a,b){return new VariableExpr(b.value)}function makeSimpleExpr(f){if(f.charAt(0)=="$"){return new VariableExpr(f.substr(1))}else{if(f.charAt(0)=="@"){var e=new NodeTestName(f.substr(1));var d=new StepExpr("attribute",e);var g=new LocationExpr();g.appendStep(d);return g}else{if(f.match(/^[0-9]+$/)){return new NumberExpr(f)}else{var e=new NodeTestName(f);var d=new StepExpr("child",e);var g=new LocationExpr();g.appendStep(d);return g}}}}function makeSimpleExpr2(h){var f=stringSplit(h,"/");var j=new LocationExpr();for(var g=0;g<f.length;++g){var e=new NodeTestName(f[g]);var d=new StepExpr("child",e);j.appendStep(d)}return j}var xpathAxis={ANCESTOR_OR_SELF:"ancestor-or-self",ANCESTOR:"ancestor",ATTRIBUTE:"attribute",CHILD:"child",DESCENDANT_OR_SELF:"descendant-or-self",DESCENDANT:"descendant",FOLLOWING_SIBLING:"following-sibling",FOLLOWING:"following",NAMESPACE:"namespace",PARENT:"parent",PRECEDING_SIBLING:"preceding-sibling",PRECEDING:"preceding",SELF:"self"};var xpathAxesRe=[xpathAxis.ANCESTOR_OR_SELF,xpathAxis.ANCESTOR,xpathAxis.ATTRIBUTE,xpathAxis.CHILD,xpathAxis.DESCENDANT_OR_SELF,xpathAxis.DESCENDANT,xpathAxis.FOLLOWING_SIBLING,xpathAxis.FOLLOWING,xpathAxis.NAMESPACE,xpathAxis.PARENT,xpathAxis.PRECEDING_SIBLING,xpathAxis.PRECEDING,xpathAxis.SELF].join("|");var TOK_PIPE={label:"|",prec:17,re:new RegExp("^\\|")};var TOK_DSLASH={label:"//",prec:19,re:new RegExp("^//")};var TOK_SLASH={label:"/",prec:30,re:new RegExp("^/")};var TOK_AXIS={label:"::",prec:20,re:new RegExp("^::")};var TOK_COLON={label:":",prec:1000,re:new RegExp("^:")};var TOK_AXISNAME={label:"[axis]",re:new RegExp("^("+xpathAxesRe+")")};var TOK_PARENO={label:"(",prec:34,re:new RegExp("^\\(")};var TOK_PARENC={label:")",re:new RegExp("^\\)")};var TOK_DDOT={label:"..",prec:34,re:new RegExp("^\\.\\.")};var TOK_DOT={label:".",prec:34,re:new RegExp("^\\.")};var TOK_AT={label:"@",prec:34,re:new RegExp("^@")};var TOK_COMMA={label:",",re:new RegExp("^,")};var TOK_OR={label:"or",prec:10,re:new RegExp("^or\\b")};var TOK_AND={label:"and",prec:11,re:new RegExp("^and\\b")};var TOK_EQ={label:"=",prec:12,re:new RegExp("^=")};var TOK_NEQ={label:"!=",prec:12,re:new RegExp("^!=")};var TOK_GE={label:">=",prec:13,re:new RegExp("^>=")};var TOK_GT={label:">",prec:13,re:new RegExp("^>")};var TOK_LE={label:"<=",prec:13,re:new RegExp("^<=")};var TOK_LT={label:"<",prec:13,re:new RegExp("^<")};var TOK_PLUS={label:"+",prec:14,re:new RegExp("^\\+"),left:true};var TOK_MINUS={label:"-",prec:14,re:new RegExp("^\\-"),left:true};var TOK_DIV={label:"div",prec:15,re:new RegExp("^div\\b"),left:true};var TOK_MOD={label:"mod",prec:15,re:new RegExp("^mod\\b"),left:true};var TOK_BRACKO={label:"[",prec:32,re:new RegExp("^\\[")};var TOK_BRACKC={label:"]",re:new RegExp("^\\]")};var TOK_DOLLAR={label:"$",re:new RegExp("^\\$")};var TOK_NCNAME={label:"[ncname]",re:new RegExp("^"+XML_NC_NAME)};var TOK_ASTERISK={label:"*",prec:15,re:new RegExp("^\\*"),left:true};var TOK_LITERALQ={label:"[litq]",prec:20,re:new RegExp("^'[^\\']*'")};var TOK_LITERALQQ={label:"[litqq]",prec:20,re:new RegExp('^"[^\\"]*"')};var TOK_NUMBER={label:"[number]",prec:35,re:new RegExp("^\\d+(\\.\\d*)?")};var TOK_QNAME={label:"[qname]",re:new RegExp("^("+XML_NC_NAME+":)?"+XML_NC_NAME)};var TOK_NODEO={label:"[nodetest-start]",re:new RegExp("^(processing-instruction|comment|text|node)\\(")};var xpathTokenRules=[TOK_DSLASH,TOK_SLASH,TOK_DDOT,TOK_DOT,TOK_AXIS,TOK_COLON,TOK_AXISNAME,TOK_NODEO,TOK_PARENO,TOK_PARENC,TOK_BRACKO,TOK_BRACKC,TOK_AT,TOK_COMMA,TOK_OR,TOK_AND,TOK_NEQ,TOK_EQ,TOK_GE,TOK_GT,TOK_LE,TOK_LT,TOK_PLUS,TOK_MINUS,TOK_ASTERISK,TOK_PIPE,TOK_MOD,TOK_DIV,TOK_LITERALQ,TOK_LITERALQQ,TOK_NUMBER,TOK_QNAME,TOK_NCNAME,TOK_DOLLAR];var XPathLocationPath={label:"LocationPath"};var XPathRelativeLocationPath={label:"RelativeLocationPath"};var XPathAbsoluteLocationPath={label:"AbsoluteLocationPath"};var XPathStep={label:"Step"};var XPathNodeTest={label:"NodeTest"};var XPathPredicate={label:"Predicate"};var XPathLiteral={label:"Literal"};var XPathExpr={label:"Expr"};var XPathPrimaryExpr={label:"PrimaryExpr"};var XPathVariableReference={label:"Variablereference"};var XPathNumber={label:"Number"};var XPathFunctionCall={label:"FunctionCall"};var XPathArgumentRemainder={label:"ArgumentRemainder"};var XPathPathExpr={label:"PathExpr"};var XPathUnionExpr={label:"UnionExpr"};var XPathFilterExpr={label:"FilterExpr"};var XPathDigits={label:"Digits"};var xpathNonTerminals=[XPathLocationPath,XPathRelativeLocationPath,XPathAbsoluteLocationPath,XPathStep,XPathNodeTest,XPathPredicate,XPathLiteral,XPathExpr,XPathPrimaryExpr,XPathVariableReference,XPathNumber,XPathFunctionCall,XPathArgumentRemainder,XPathPathExpr,XPathUnionExpr,XPathFilterExpr,XPathDigits];var Q_01={label:"?"};var Q_MM={label:"*"};var Q_1M={label:"+"};var ASSOC_LEFT=true;var xpathGrammarRules=[[XPathLocationPath,[XPathRelativeLocationPath],18,passExpr],[XPathLocationPath,[XPathAbsoluteLocationPath],18,passExpr],[XPathAbsoluteLocationPath,[TOK_SLASH,XPathRelativeLocationPath],18,makeLocationExpr1],[XPathAbsoluteLocationPath,[TOK_DSLASH,XPathRelativeLocationPath],18,makeLocationExpr2],[XPathAbsoluteLocationPath,[TOK_SLASH],0,makeLocationExpr3],[XPathAbsoluteLocationPath,[TOK_DSLASH],0,makeLocationExpr4],[XPathRelativeLocationPath,[XPathStep],31,makeLocationExpr5],[XPathRelativeLocationPath,[XPathRelativeLocationPath,TOK_SLASH,XPathStep],31,makeLocationExpr6],[XPathRelativeLocationPath,[XPathRelativeLocationPath,TOK_DSLASH,XPathStep],31,makeLocationExpr7],[XPathStep,[TOK_DOT],33,makeStepExpr1],[XPathStep,[TOK_DDOT],33,makeStepExpr2],[XPathStep,[TOK_AXISNAME,TOK_AXIS,XPathNodeTest],33,makeStepExpr3],[XPathStep,[TOK_AT,XPathNodeTest],33,makeStepExpr4],[XPathStep,[XPathNodeTest],33,makeStepExpr5],[XPathStep,[XPathStep,XPathPredicate],33,makeStepExpr6],[XPathNodeTest,[TOK_ASTERISK],33,makeNodeTestExpr1],[XPathNodeTest,[TOK_NCNAME,TOK_COLON,TOK_ASTERISK],33,makeNodeTestExpr2],[XPathNodeTest,[TOK_QNAME],33,makeNodeTestExpr3],[XPathNodeTest,[TOK_NODEO,TOK_PARENC],33,makeNodeTestExpr4],[XPathNodeTest,[TOK_NODEO,XPathLiteral,TOK_PARENC],33,makeNodeTestExpr5],[XPathPredicate,[TOK_BRACKO,XPathExpr,TOK_BRACKC],33,makePredicateExpr],[XPathPrimaryExpr,[XPathVariableReference],33,passExpr],[XPathPrimaryExpr,[TOK_PARENO,XPathExpr,TOK_PARENC],33,makePrimaryExpr],[XPathPrimaryExpr,[XPathLiteral],30,passExpr],[XPathPrimaryExpr,[XPathNumber],30,passExpr],[XPathPrimaryExpr,[XPathFunctionCall],30,passExpr],[XPathFunctionCall,[TOK_QNAME,TOK_PARENO,TOK_PARENC],-1,makeFunctionCallExpr1],[XPathFunctionCall,[TOK_QNAME,TOK_PARENO,XPathExpr,XPathArgumentRemainder,Q_MM,TOK_PARENC],-1,makeFunctionCallExpr2],[XPathArgumentRemainder,[TOK_COMMA,XPathExpr],-1,makeArgumentExpr],[XPathUnionExpr,[XPathPathExpr],20,passExpr],[XPathUnionExpr,[XPathUnionExpr,TOK_PIPE,XPathPathExpr],20,makeUnionExpr],[XPathPathExpr,[XPathLocationPath],20,passExpr],[XPathPathExpr,[XPathFilterExpr],19,passExpr],[XPathPathExpr,[XPathFilterExpr,TOK_SLASH,XPathRelativeLocationPath],20,makePathExpr1],[XPathPathExpr,[XPathFilterExpr,TOK_DSLASH,XPathRelativeLocationPath],20,makePathExpr2],[XPathFilterExpr,[XPathPrimaryExpr,XPathPredicate,Q_MM],20,makeFilterExpr],[XPathExpr,[XPathPrimaryExpr],16,passExpr],[XPathExpr,[XPathUnionExpr],16,passExpr],[XPathExpr,[TOK_MINUS,XPathExpr],-1,makeUnaryMinusExpr],[XPathExpr,[XPathExpr,TOK_OR,XPathExpr],-1,makeBinaryExpr],[XPathExpr,[XPathExpr,TOK_AND,XPathExpr],-1,makeBinaryExpr],[XPathExpr,[XPathExpr,TOK_EQ,XPathExpr],-1,makeBinaryExpr],[XPathExpr,[XPathExpr,TOK_NEQ,XPathExpr],-1,makeBinaryExpr],[XPathExpr,[XPathExpr,TOK_LT,XPathExpr],-1,makeBinaryExpr],[XPathExpr,[XPathExpr,TOK_LE,XPathExpr],-1,makeBinaryExpr],[XPathExpr,[XPathExpr,TOK_GT,XPathExpr],-1,makeBinaryExpr],[XPathExpr,[XPathExpr,TOK_GE,XPathExpr],-1,makeBinaryExpr],[XPathExpr,[XPathExpr,TOK_PLUS,XPathExpr],-1,makeBinaryExpr,ASSOC_LEFT],[XPathExpr,[XPathExpr,TOK_MINUS,XPathExpr],-1,makeBinaryExpr,ASSOC_LEFT],[XPathExpr,[XPathExpr,TOK_ASTERISK,XPathExpr],-1,makeBinaryExpr,ASSOC_LEFT],[XPathExpr,[XPathExpr,TOK_DIV,XPathExpr],-1,makeBinaryExpr,ASSOC_LEFT],[XPathExpr,[XPathExpr,TOK_MOD,XPathExpr],-1,makeBinaryExpr,ASSOC_LEFT],[XPathLiteral,[TOK_LITERALQ],-1,makeLiteralExpr],[XPathLiteral,[TOK_LITERALQQ],-1,makeLiteralExpr],[XPathNumber,[TOK_NUMBER],-1,makeNumberExpr],[XPathVariableReference,[TOK_DOLLAR,TOK_QNAME],200,makeVariableReference]];var xpathRules=[];function xpathParseInit(){if(xpathRules.length){return}xpathGrammarRules.sort(function(i,h){var k=i[1].length;var j=h[1].length;if(k<j){return 1}else{if(k>j){return -1}else{return 0}}});var a=1;for(var c=0;c<xpathNonTerminals.length;++c){xpathNonTerminals[c].key=a++}for(c=0;c<xpathTokenRules.length;++c){xpathTokenRules[c].key=a++}xpathLog("XPath parse INIT: "+a+" rules");function e(j,h,i){if(!j[h]){j[h]=[]}j[h].push(i)}for(c=0;c<xpathGrammarRules.length;++c){var g=xpathGrammarRules[c];var f=g[1];for(var b=f.length-1;b>=0;--b){if(f[b]==Q_1M){e(xpathRules,f[b-1].key,g);break}else{if(f[b]==Q_MM||f[b]==Q_01){e(xpathRules,f[b-1].key,g);--b}else{e(xpathRules,f[b].key,g);break}}}}xpathLog("XPath parse INIT: "+xpathRules.length+" rule bins");var d=0;mapExec(xpathRules,function(h){if(h){d+=h.length}});xpathLog("XPath parse INIT: "+(d/xpathRules.length)+" average bin size")}function xpathCollectDescendants(b,a){for(var c=a.firstChild;c;c=c.nextSibling){b.push(c);arguments.callee(b,c)}}function xpathCollectDescendantsReverse(b,a){for(var c=a.lastChild;c;c=c.previousSibling){b.push(c);arguments.callee(b,c)}}function xpathDomEval(c,b){var d=xpathParse(c);var a=d.evaluate(new ExprContext(b));return a}function xpathSort(h,f){if(f.length==0){return}var n=[];for(var g=0;g<h.contextSize();++g){var c=h.nodelist[g];var d={node:c,key:[]};var b=h.clone(c,0,[c]);for(var e=0;e<f.length;++e){var m=f[e];var l=m.expr.evaluate(b);var k;if(m.type=="text"){k=l.stringValue()}else{if(m.type=="number"){k=l.numberValue()}}d.key.push({value:k,order:m.order})}d.key.push({value:g,order:"ascending"});n.push(d)}n.sort(xpathSortByKey);var a=[];for(var g=0;g<n.length;++g){a.push(n[g].node)}h.nodelist=a;h.setNode(0)}function xpathSortByKey(d,c){for(var a=0;a<d.key.length;++a){var b=d.key[a].order=="descending"?-1:1;if(d.key[a].value>c.key[a].value){return +1*b}else{if(d.key[a].value<c.key[a].value){return -1*b}}}return 0}function xpathEval(a,c){var d=xpathParse(a);var b=d.evaluate(c);return b};