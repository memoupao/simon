<?php include("../../../includes/constantes.inc.php"); ?><?php include("../../../includes/validauser.inc.php"); ?><?phprequire_once (constant("PATH_CLASS") . "BLMonitoreoFinanciero.class.php");require_once (constant("PATH_CLASS") . "BLPresupuesto.class.php");require_once (constant("PATH_CLASS") . "HardCode.class.php");// require_once(constant("PATH_CLASS")."BLManejoProy.class.php");$objInf = new BLMonitoreoFinanciero();$objPresup = new BLPresupuesto();$HardCode = new HardCode();// $idVersion = $objPresup->Proyecto->MaxVersion($idProy);error_reporting("E_PARSE");$idProy = $objFunc->__POST('idProy');$idComp = $objFunc->__POST('idComp');$idInforme = $objFunc->__POST('idNum');$idFuente = $objFunc->__POST('idFuente');// $idFte = $objFunc->__POST('idFte');$row = $objInf->Inf_MF_Seleccionar($idProy, $idInforme);if ($idProy == "") {        ?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><!-- InstanceBegin template="/Templates/templateIframe.dwt.php" codeOutsideHTMLIsLocked="false" --><head><meta http-equiv="Content-Type"	content="text/html; charset=charset=utf-8" /><!-- InstanceBeginEditable name="doctitle" --><title>Informe Gastos x SubActividad</title><!-- InstanceEndEditable --><!-- InstanceBeginEditable name="head" --><script language="javascript" type="text/javascript"	src="../../../jquery.ui-1.5.2/jquery-1.2.6.js"></script><!-- InstanceEndEditable --><link href="../../../css/itemplate.css" rel="stylesheet" type="text/css"	media="all" /></head><body>	<!-- InstanceBeginEditable name="tBody" -->	<form id="frmMain" name="frmMain" method="post" action="#"><?php}// --> Validamos que se haya pasado correctamente el ID del Informe, para calacular el periodo de EjecuciÃ³nif ($idInforme == "") {        $objFunc->MensajeError("No se ha Establecido el Periodo de Referencia para el Informe de Monitoreo Financiero");        $idComp = - 1;}?><div id="divTableLista">			<span style="color: #03C; font-size: 10px;">Para Ingresar los Gastos				No Aceptados, Hacer click sobre el Vinculo en la columna				&quot;Gastos No Aceptado&quot;</span>			<table width="771" border="1" cellpadding="0" cellspacing="0">				<tr style="border: solid 1px #CCC; background-color: #eeeeee;">					<th width="53" rowspan="2" align="center" valign="middle">Codigo</th>					<th width="144" rowspan="2" align="center" valign="middle">Actividades</th>					<th width="47" rowspan="2" align="center" valign="middle">U.M.</th>					<th width="75" rowspan="2" align="center" valign="middle">Presupuesto					</th>					<th height="28" colspan="4" align="center" valign="middle">Total Periodo <?php echo(" (".$row['t51_per_ini']." - ".$row['t51_per_fin'].")"); ?></th>					<th width="209" rowspan="2" align="center" valign="middle">Observaciones</th>				</tr>				<tr style="border: solid 1px #CCC; background-color: #eeeeee;">					<th width="70" height="28" align="center" valign="middle">Programado</th>					<th width="70" align="center" valign="middle">Ejecutado</th>					<th width="35" align="center" valign="middle">% Ejec.</th>					<th width="35" align="center" valign="middle">Gastos No Aceptado</th>				</tr>              <?php        $totalEjecutado = 0;        $idAct = 1;        $total_presup = 0;        $total_ejec = 0;        $total_GNA = 0;        $iRsAct = $objInf->Inf_MF_ListadoPersonal($idProy, $idInforme, $idFuente);        $rowAct = mysqli_fetch_assoc($iRsAct);        ;        $total_presup += $rowAct['total_fuente'];        $total_ejec += $rowAct['ejecutado'];        $total_planeado += $rowAct['planeado'];        $porcEjecucion = round((($rowAct['ejecutado'] / $rowAct['planeado']) * 100), 2);        ?>  	  <tbody class="data">					<tr style="background-color: #FC9; height: 25px; cursor: pointer;"						onclick="ShowActividad('<?php echo("tbody_".$idFuente.'_'.$idAct);?>');">						<td align="left" nowrap="nowrap"><?php echo($HardCode->CodigoMP.".1");?></td>						<td colspan="3" align="left"><?php echo( "Personal del Proyecto");?></td>						<td align="center"><?php echo(number_format($rowAct['planeado'],2,'.',','));?></td>						<td align="right"><?php echo(number_format($rowAct['ejecutado'],2,'.',','));?></td>						<td align="right"><?php echo($porcEjecucion);?>%</td>						<td align="center">&nbsp;</td>						<td align="center">&nbsp;</td>					</tr>				</tbody>				<tbody class="data" bgcolor="#FFFFFF"					id="<?php echo("tbody_".$idFuente.'_'.$idAct);?>">					<tr style="background-color: #E3FEE0;">						<td align="left" nowrap="nowrap"><?php echo($HardCode->CodigoMP.".1.12");?></td>						<td colspan="3" align="left"><?php echo( "Remuneraciones");?></td>						<!--td align="right"><?php echo(number_format($rowPer['gasto_tot'],2));?></td>          <td align="right"><strong><?php echo(number_format($rowPer['total_fuente'],2));?></strong></td>          <td align="right"><?php echo(number_format($rowPer['planeado'],2));?></td>          <td align="right"><?php echo(number_format($rowPer['ejecutado'],2));?></td-->						<td align="center">&nbsp;</td>						<td align="center">&nbsp;</td>						<td align="center">&nbsp;</td>						<td align="center">&nbsp;</td>						<td colspan="2" align="center">&nbsp;</td>					</tr>       <?php        $rsPer = $objInf->Inf_MF_ListaPer($idProy, $idInforme, $idFuente);        while ($rowsub = mysqli_fetch_assoc($rsPer))     {                /*         * $idtxtAvance = $idFte."_txtRubroEjec[]"; $idtxtCodigo = $idFte."_Id[]"; $inputTextAvance = "<input gastosEjemp='1' name='".$idtxtAvance."' type='text' id='".$idtxtAvance."' style='padding:0px; width:100%; height:100%; text-align:center;' ".($rowPer['total_fuente']==0 ? 'readonly' : '')." ".($IsMF==true ? 'disabled' : '')." value='".$rowPer['ejecutado']."' size='4' class='presup' />" ; $inputTextID = "<input value='".$rowPer['codigo']."' name='".$idtxtCodigo."' type='hidden' id='".$idtxtCodigo."' class='presup' />" ; $inputTextEst = "<input value='".$rowPer['estado']."' name='".$idFte."_Estado[]' type='hidden' id='".$idFte."_Estado[]' class='presup' />" ; //$inputTextObs = "<input value='".$rowPer['observ']."' name='".$idFte."_Obs[]' type='hidden' id='".$idFte."_Obs[]' class='presup' />" ; $inputTextObs = "<textarea name='".$idFte."_Obs[]' id='".$idFte."_Obs[]' class='presup' style='width:99%; height:99%;' >".$rowPer['observ']."</textarea>" ;         */                $total_ejec += $rowsub['ejecutado'];                $total_GNA += $rowsub['gasto_no_aceptado'];                $porcEjecucion = round((($rowsub['ejecutado'] / $rowsub['planeado']) * 100), 2);                ?>         <tr style='color: navy;'>						<td align="left" nowrap="nowrap"><?php echo($rowsub['codigo']);?>        </td>						<td align="left"><?php echo( $rowsub['cargo']);?>        												<td align="center"><?php echo($rowsub['um']);?></td>						<td align="center"><?php echo(number_format($rowsub['gasto_tot'],2,'.',','));?></td>						<td align="right"><?php echo(number_format($rowsub['planeado'],2,'.',','));?></td>						<td align="right"><?php echo(number_format($rowsub['ejecutado'],2,'.',','));?></td>						<td align="center"><?php echo($porcEjecucion);?>%</td>						<td align="center">        <?php if($rowsub['ejecutado']<=0) { ?>        <?php echo(number_format($rowsub['gasto_no_aceptado'],2));?>        <?php } else { ?>        <a href="javascript:;"							onclick="AgregarGastosNoAceptados('<?php echo($rowsub['codigo']);?>');"><?php echo(number_format($rowsub['gasto_no_aceptado'],2));?></a>        <?php } ?>        </td>						<td align="center"><textarea name="txtcoment_presup[]" rows="2"								class='presup' id="txtcoment_presup[]"								style="width: 100%; height: 100%"><?php echo($rowsub['observaciones']);?></textarea>							<input type="hidden" name="txt_cod_sub[]"							value="<?php $arrCodi = explode(".",$rowsub['codigo']); $cod = $arrCodi[1].'.'.$arrCodi[2].'.'.$arrCodi[3]; echo($cod);?>"							class='presup' /></td>					</tr>      <?php    }        $rsPer->free();        ?>        </tbody>		<?php$idAct = 2;$rsEqui = $objInf->Inf_MF_ListaE_Total($idProy, $idInforme, $idFuente);$rowEqui = mysqli_fetch_assoc($rsEqui);$total_presup += $rowEqui['gasto_tot'];$total_planeado += $rowEqui['planeado'];$total_fuente += $rowEqui['total_fuente'];$total_ejecutado += $rowEqui['ejecutado'];$rsEqui->free();if ($rowEqui['ejecutado'] != 0)        $porcEjecucion = round((($rowEqui['ejecutado'] / $rowEqui['planeado']) * 100), 2);else        $porcEjecucion = 0;?>		<tbody class="data">					<tr style="background-color: #FC9; height: 25px; cursor: pointer;"						onclick="ShowActividad('<?php echo("tbody_".$idFuente.'_'.$idAct);?>');">						<td align="left" nowrap="nowrap"><?php echo($HardCode->CodigoMP.".2");?></td>						<td colspan="3" align="left"><?php echo( "Equipamiento del Proyecto");?></td>						<!--td align="center"><?php echo(number_format($rowEqui['planeado'],2,'.',','));?></td>          <td align="right"><?php echo(number_format($rowEqui['ejecutado'],2,'.',','));?></td>          <td align="right"><?php echo($porcEjecucion);?>%</td-->						<td align="center">&nbsp;</td>						<td align="center">&nbsp;</td>						<td align="center">&nbsp;</td>						<td align="center">&nbsp;</td>						<td align="center">&nbsp;</td>					</tr>				</tbody>				<tbody class="data" bgcolor="#FFFFFF"					id="<?php echo("tbody_".$idFuente.'_'.$idAct);?>">					<tr style="background-color: #E3FEE0;">						<td align="left" nowrap="nowrap"><?php echo($HardCode->CodigoMP.".$idAct.3");?></td>						<td colspan="3" align="left"><?php echo( "Equipos y Bienes Duraderos");?></td>						<td align="right"><?php echo(number_format($rowEqui['gasto_tot'],2));?></td>						<td align="right"><?php echo(number_format($rowEqui['total_fuente'],2));?></td>						<td align="right"><?php echo(number_format($rowEqui['planeado'],2));?></td>						<td align="right"><?php echo(number_format($rowEqui['ejecutado'],2));?></td>						<td colspan="2" align="center">&nbsp;</td>					</tr>						<?php$rsEqui = $objInf->Inf_MF_ListaEqui($idProy, $idInforme, $idFuente);while ($rowEqui = mysqli_fetch_assoc($rsEqui)) {        $total_ejec += $rowsub['ejecutado'];        $total_GNA += $rowEqui['gasto_no_aceptado'];        $porcEjecucion = round((($rowEqui['ejecutado'] / $rowEqui['planeado']) * 100), 2);        ?>         <tr style='color: navy;'>						<td align="left" nowrap="nowrap"><?php echo($rowEqui['codigo']);?>        </td>						<td align="left"><?php echo( $rowEqui['equipo']);?>        												<td align="center"><?php echo($rowEqui['um']);?></td>						<td align="center"><?php echo(number_format($rowEqui['costo_tot'],2,'.',','));?></td>						<td align="right"><?php echo(number_format($rowEqui['planeado'],2,'.',','));?></td>						<td align="right"><?php echo(number_format($rowEqui['ejecutado'],2,'.',','));?></td>						<td align="center"><?php echo($porcEjecucion);?>%</td>						<td align="center">        <?php if($rowEqui['ejecutado']<=0) { ?>        <?php echo(number_format($rowEqui['gasto_no_aceptado'],2));?>        <?php } else { ?>        <a href="javascript:;"							onclick="AgregarGastosNoAceptados('<?php echo($rowEqui['codigo']);?>');"><?php echo(number_format($rowEqui['gasto_no_aceptado'],2));?></a>        <?php } ?>        </td>						<td align="center"><textarea name="txtcoment_presup[]" rows="2"								class='presup' id="txtcoment_presup[]"								style="width: 100%; height: 100%"><?php echo($rowEqui['observaciones']);?></textarea></td>						<input type="hidden" name="txt_cod_sub[]"							value="<?php $arrCodi = explode(".",$rowEqui['codigo']); $cod = $arrCodi[1].'.'.$arrCodi[2].'.'.$arrCodi[3]; echo($cod); ?>"							class='presup' />					</tr>      <?php}$rsEqui->free();?>        </tbody>		<?php$total_ejec = 0;$idAct = 2;$rsGF = $objInf->Inf_MF_GastoFuncionamiento_Total($idProy, $idInforme, $idFuente);$rowGF = mysqli_fetch_assoc($rsGF);$rsGF->free();$idAct = 3;$total_presup += $rowGF['gasto_tot'];$total_planeado += $rowGF['planeado'];$total_fuente += $rowGF['total_fuente'];$total_ejecutado += $rowGF['ejecutado'];$porcEjecucion = round((($rowGF['ejecutado'] / $rowGF['planeado']) * 100), 2);?>  		<tbody class="data">					<tr style="background-color: #FC9; height: 25px; cursor: pointer;"						onclick="ShowActividad('<?php echo("tbody_".$idFuente.'_'.$idAct);?>');">						<td align="left" nowrap="nowrap"><?php echo($HardCode->CodigoMP.".3");?></td>						<td colspan="3" align="left"><?php echo( "Gastos de Funcionamiento");?></td>						<td align="center"><?php echo(number_format($rowGF['planeado'],2,'.',','));?></td>						<td align="right"><?php echo(number_format($rowGF['ejecutado'],2,'.',','));?></td>						<td align="right"><?php echo($porcEjecucion);?>%</td>						<td align="center">&nbsp;</td>						<td align="center">&nbsp;</td>					</tr>				</tbody>				<tbody class="data" bgcolor="#FFFFFF"					id="<?php echo("tbody_".$idFuente.'_'.$idAct);?>">		 <?php$iRs = $objInf->Inf_MF_Financ_Lista_PartidasGF($idProy, $idInforme, $idFuente);while ($rowsub = mysqli_fetch_assoc($iRs)) {        $porcEjecucion = round((($rowsub['ejecutado'] / $rowsub['planeado']) * 100), 2);        ?>        <tr style="background-color: #E3FEE0;">						<td align="left" nowrap="nowrap"><?php echo($rowsub['codigo']);?>        </td>						<td align="left"><?php echo( $rowsub['partida']);?></td>						<td align="center"><?php echo($rowsub['um']);?></td>						<td align="right"><?php echo( $rowsub['gasto_tot']);?></td>						<td align="right"><?php echo(number_format($rowsub['planeado'],2));?></td>						<td align="right"><?php echo(number_format($rowsub['ejecutado'],2));?></td>						<td align="center"><?php echo $porcEjecucion; ?>%</td>						<td align="center">&nbsp;</td>						<td align="center">&nbsp;</td>					</tr>		<?php    $LG = $objInf->GastFunc_ListadoCategMF($idProy, $idInforme, $idFuente, $rowsub['idpartida']);        while ($rowlg = mysqli_fetch_assoc($LG))     {                $total_ejec = $rowlg['ejecutado'];                $total_GNA += $rowlg['gasto_no_aceptado'];                $porcEjecucionlg = round((($rowlg['ejecutado'] / $rowlg['planeado']) * 100), 2);                ?>		<tr style='color: navy;'>						<td align="left" nowrap="nowrap"><?php echo('3.'.$rowlg['codigo']);?>        </td>						<td align="left"><?php echo( $rowlg['categoria']);?></td>						<td align="center"><?php echo($rowlg['um']);?></td>						<td align="right"><?php echo( $rowlg['total']);?></td>						<td align="right"><?php echo(number_format($rowlg['planeado'],2));?></td>						<td align="right"><?php echo(number_format($rowlg['ejecutado'],2));?></td>						<td align="center"><?php echo $porcEjecucionlg; ?>%</td>						<td align="center">        <?php if($rowlg['ejecutado']<=0) { ?>        <?php echo(number_format($rowlg['gasto_no_aceptado'],2));?>        <?php } else { ?>        <a href="javascript:;"							onclick="AgregarGastosNoAceptados('<?php echo('10.3.'.$rowlg['codigo']);?>');"><?php echo(number_format($rowlg['gasto_no_aceptado'],2));?></a>        <?php } ?>        </td>						<td align="center"><textarea name="txtcoment_presup[]" rows="2"								class='presup' id="txtcoment_presup[]"								style="width: 100%; height: 100%"><?php echo($rowlg['observaciones']);?></textarea>							<input type="hidden" name="txt_cod_sub[]"							value="<?php $arrCodi = explode(".",$rowlg['codigo']); $cod = '3.'.$arrCodi[0].'.'.$arrCodi[1]; echo($cod); ?>"							class='presup' /></td>					</tr>	  <?php    }}$iRs->free(); // Fin de SubActividades?>            </tbody>				<tbody class="data">	   	    <?php        $idAct = 4;        $iRsG = $objInf->Inf_MF_Financ_Lista_GastosAdministrativos($idProy, $idInforme, $idFuente);        $rowG = mysqli_fetch_assoc($iRsG);        $iRsG->free();        $total_fuente += $rowG['total_fuente'];        $total_presup += $rowG['gasto_tot'];        $total_planeado += $rowG['planeado'];        $total_fuente += $rowG['total_fuente'];        $total_ejec += $rowG['ejecutado'];        /*     * $idtxtAvance = $idFte."_txtRubroEjec[]"; $idtxtCodigo = $idFte."_Id[]"; $inputTextAvance = "<input gastosEjemp='1' name='".$idtxtAvance."' type='text' id='".$idtxtAvance."' style='padding:0px; width:100%; height:100%; text-align:center;' ".($rowG['total_fuente']==0 ? 'readonly' : '')." ".($IsMF==true ? 'disabled' : '')." value='".$rowG['ejecutado']."' size='4' class='presup' />" ; $inputTextID = "<input value='".$rowG['codigo']."' name='".$idtxtCodigo."' type='hidden' id='".$idtxtCodigo."' class='presup' />" ; $inputTextEst = "<input value='".$rowG['estado']."' name='".$idFte."_Estado[]' type='hidden' id='".$idFte."_Estado[]' class='presup' />" ; //$inputTextObs = "<input value='".$rowG['observ']."' name='".$idFte."_Obs[]' type='hidden' id='".$idFte."_Obs[]' class='presup' />" ; $inputTextObs = "<textarea name='".$idFte."_Obs[]' id='".$idFte."_Obs[]' class='presup' style='width:99%; height:99%;' >".$rowG['observ']."</textarea>" ;     */        $porcEjecucion = round((($rowG['ejecutado'] / $rowG['planeado']) * 100), 2);        if ($porcEjecucion > 100)        $porcEjecucion = 100;        ?>		  <tr style="background-color: #FC9; height: 25px; cursor: pointer;">						<td align="left" nowrap="nowrap"><?php echo($rowG['codigo']);?></td>						<td colspan="3" align="left"><?php echo( $rowG['descripcion']);?></td>						<td align="center"><?php echo(number_format($rowG['planeado'],2));?></td>						<td align="right"><?php echo(number_format($rowG['ejecutado'],2));?></td>						<td align="right"><?php echo $porcEjecucion; ?>%</td>						<td align="center" nowrap="nowrap"></td>						<td colspan="2" align="center" nowrap="nowrap"></td>					</tr>		 		<?php$idAct = 6;$iRsI = $objInf->Inf_MF_Financ_Lista_Imprevistos($idProy, $idInforme, $idFuente);$rowI = mysqli_fetch_assoc($iRsI);$iRsI->free();$total_presup += $rowI['gasto_tot'];$total_planeado += $rowI['planeado'];$total_fuente += $rowI['total_fuente'];$total_ejec += $rowI['ejecutado'];/* * $idtxtAvance = $idFte."_txtRubroEjec[]"; $idtxtCodigo = $idFte."_Id[]"; $inputTextAvance = "<input gastosEjemp='1' name='".$idtxtAvance."' type='text' id='".$idtxtAvance."' style='padding:0px; width:100%; height:100%; text-align:center;' ".($rowI['total_fuente']==0 ? 'readonly' : '')." ".($IsMF==true ? 'disabled' : '')." value='".$rowI['ejecutado']."' size='4' class='presup' />" ; $inputTextID = "<input value='".$rowI['codigo']."' name='".$idtxtCodigo."' type='hidden' id='".$idtxtCodigo."' class='presup' />" ; $inputTextEst = "<input value='".$rowI['estado']."' name='".$idFte."_Estado[]' type='hidden' id='".$idFte."_Estado[]' class='presup' />" ; //$inputTextObs = "<input value='".$rowI['observ']."' name='".$idFte."_Obs[]' type='hidden' id='".$idFte."_Obs[]' class='presup' />" ; $inputTextObs = "<textarea name='".$idFte."_Obs[]' id='".$idFte."_Obs[]' class='presup' style='width:99%; height:99%;' >".$rowI['observ']."</textarea>" ; */$porcEjecucion = round((($rowI['ejecutado'] / $rowI['planeado']) * 100), 2);if ($porcEjecucion > 100)    $porcEjecucion = 100;?>				<tr style="background-color: #FC9; height: 25px; cursor: pointer;">						<td align="left" nowrap="nowrap"><?php echo($rowI['codigo']);?></td>						<td colspan="3" align="left"><?php echo( $rowI['descripcion']);?></td>						<td align="center"><?php echo(number_format($rowI['planeado'],2));?></td>						<td align="right"><?php echo(number_format($rowI['ejecutado'],2));?></td>						<td align="right"><?php echo $porcEjecucion; ?>%</td>						<td align="center" nowrap="nowrap"></td>						<td colspan="2" align="center" nowrap="nowrap"></td>					</tr>				</tbody>				<tfoot>					<tr style="color: #FFF; height: 20px;">						<th colspan="3">Totales x Componente &nbsp;&nbsp;</th>						<th align="center"><?php echo(number_format($total_presup,2,'.',','));?></th>						<th align="right"><?php echo(number_format($total_planeado,2,'.',','));?>&nbsp;</th>						<th align="right"><?php echo(number_format($total_ejec    ,2,'.',','));?>&nbsp;</th>						<th align="center"><?php $totalp = round((($total_ejec/$total_planeado)*100),2); if($totalp > 100){$totalp = 100;} print $totalp; ?>%</th>						<th align="center"><?php echo(number_format($total_GNA,2));?></th>						<th align="right">&nbsp;</th>					</tr>				</tfoot>			</table>			<input type="hidden" name="t02_cod_proy"				value="<?php echo($idProy);?>" class='presup' /> <input				type="hidden" name="t08_cod_comp" value="<?php echo($idComp);?>"				class='presup' /> <input type="hidden" name="t51_num" id="t51_num"				value="<?php echo($idInforme);?>" class='presup' /> <input				type="hidden" name="idFuente" id="idFuente"				value="<?php echo($idFuente);?>" class='presup' />			<script language="javascript" type="text/javascript">function AgregarGastosNoAceptados(codigo){	var urlGastos = "inf_financ_presup_gasto.php?idProy=<?php echo($idProy);?>&idInforme=<?php echo($idInforme);?>&idFuente=<?php echo($idFuente);?>&codigo=" + codigo;	loadPopup("Gastos No Aceptados Mensuales", urlGastos); }function ShowActividad(idAct) {	 var id = "#" + idAct ;	 $(id).toggle();	 return false; } </script>		</div><?php if($idProy=="") { ?></form>	<!-- InstanceEndEditable --></body><!-- InstanceEnd --></html><?php } ?>